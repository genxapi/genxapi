# generate-api-client

Command-line tool that scaffolds a fully configured API client project (based on [Orval](https://orval.dev/)) from a reusable template. The CLI loads its settings from `api-client-generatorrc.*` files or from flags provided on the command line and then:

1. Copies the requested template into the target folder.
2. Injects configuration values (package name, OpenAPI document path, base URL, etc.).
3. Optionally copies the OpenAPI document into the project.
4. Installs dependencies and runs the Orval generator inside the new project.

## Quick Start

```bash
npm install --save-dev generate-api-client
```

Create `api-client-generatorrc.json` (see [sample-config](./sample-config/api-client-generatorrc.json)):

```jsonc
{
  "template": "client-api",
  "targetDirectory": "./packages/nestjs-api-hooks",
  "projectName": "nestjs-api-hooks",
  "swaggerPath": "./swagger-specs/petstore.yaml",
  "packageManager": "npm",
  "orval": {
    "command": "build"
  }
}
```

Generate the client project:

```bash
npx generate-api-client --config api-client-generatorrc.json
```

You can also provide settings entirely via flags:

```bash
npx generate-api-client \ 
  --target ./packages/nestjs-api-hooks \ 
  --project-name nestjs-api-hooks \ 
  --swagger ./swagger-specs/petstore.yaml \ 
  --package-manager pnpm
```

## Configuration Reference

| Field | Description | Default |
| ----- | ----------- | ------- |
| `template` | Template folder under `templates/` to copy. | `client-api` |
| `targetDirectory` | Directory where the template should be copied. | – (required) |
| `projectName` | Package name to apply inside the template (falls back to the target folder name). | derived |
| `packageManager` | Package manager used for install/run (`npm`, `pnpm`, `yarn`, `bun`). | `npm` |
| `swaggerPath` | Path or URL to the OpenAPI/Swagger document. | – (required) |
| `copySwagger` | Copy the OpenAPI file into the project before running Orval. Disabled automatically for remote URLs. | `true` |
| `swaggerCopyTarget` | Destination filename (relative to the project root) when copying the OpenAPI file. | `swagger-spec.json` |
| `installDependencies` | Install the template dependencies before generation. | `true` |
| `runGenerate` | Execute the Orval command after scaffolding. | `true` |
| `force` | Overwrite any files already present in the target directory. | `false` |
| `orval.configPath` | Path (relative to the project root) to the Orval configuration file. | `orval.config.ts` |
| `orval.workspace` | Workspace directory used by Orval to emit files. | `./src/` |
| `orval.targetFile` | Entry file generated by Orval. | `./dogs.ts` |
| `orval.mode` | Orval output mode. | `tags-split` |
| `orval.client` | Orval client implementation (e.g. `react-query`). | `react-query` |
| `orval.baseUrl` | Base URL injected into the Orval config. | `http://localhost:3000` |
| `orval.mock` | Whether to enable Orval mock generation. | `true` |
| `orval.prettier` | Whether to format Orval output with Prettier. | `true` |
| `orval.command` | Script name executed to run Orval inside the template. | `generate` |
| `orval.postGenerateScript` | Additional script to run after the Orval command succeeds. | – |
| `templateVariables` | Additional placeholder values injected into the template (keys become `__KEY__`). | `{}` |

All relative paths are resolved from the configuration file location. CLI flags override values from the config file.

## Template: `client-api`

The built-in template is inspired by [nestjs-api-hooks](https://github.com/EduardoAC/contract-api-generation-orval-demo/tree/main/packages/nestjs-api-hooks) and ships with:

- Rollup-based build (`rollup`, `@rollup/plugin-typescript`, `rollup-plugin-dts`).
- TypeScript project configuration (`tsconfig.json`, `tsconfig.build.json`).
- Orval configuration pre-wired for React Query clients and mock generation.
- Scripts for `generate` (Orval) and `build` (Orval + Rollup bundle).

Template files make heavy use of placeholder tokens such as `__PACKAGE_NAME__`, `__SWAGGER_PATH__`, and `__ORVAL_BASE_URL__`; the CLI replaces them with values coming from the configuration or flags.

## Helpful Flags

| Flag | Effect |
| ---- | ------ |
| `--config <path>` | Explicit configuration file to load. |
| `--target <dir>` | Target directory (overrides `targetDirectory`). |
| `--project-name <name>` | Package name override. |
| `--swagger <pathOrUrl>` | OpenAPI source override. |
| `--swagger-target <filename>` | Name of the copied OpenAPI file. |
| `--package-manager <npm|pnpm|yarn|bun>` | Package manager override. |
| `--skip-install` | Skip dependency installation. |
| `--skip-generate` | Skip executing the Orval command. |
| `--skip-copy-swagger` | Prevent copying the OpenAPI document into the new project. |
| `--force` | Overwrite existing files within the target directory. |
| `--template-var KEY=VALUE` | Inject an additional placeholder value (repeatable). |
| `--orval-command <script>` | Override the script name used to run Orval. |
| `--post-generate <script>` | Script run after Orval completes. |

## Development

```bash
npm install
npm run dev
```

The CLI is built with [`@stricli/core`](https://github.com/bloomberg/stricli) and bundled via `tsup`. Both ES module and CommonJS entry points are emitted.
