---
title: "CI Integration"
---

# CI Integration

Automate client generation in your pipelines to keep SDKs in sync with your APIs. This guide covers GitHub Actions, reproducible builds, and extending to other CI providers.

## GitHub Actions Workflow

Create `.github/workflows/generate-clients.yml`:

```yaml
name: Generate API Clients

on:
  workflow_dispatch:
  schedule:
    - cron: "0 6 * * 1" # every Monday
  push:
    paths:
      - genxapi.config.*
      - specs/**

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      packages: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install CLI
        run: npm install --no-save @genxapi/cli

      - name: Generate clients
        env:
          GITHUB_TOKEN: ${{ secrets.GENERATOR_GITHUB_TOKEN }}
          NPM_TOKEN: ${{ secrets.NPM_AUTOMATION_TOKEN }}
        run: npx genxapi generate --log-level info

      - name: Publish release
        if: success() && github.event_name == 'workflow_dispatch'
        env:
          GITHUB_TOKEN: ${{ secrets.GENERATOR_GITHUB_TOKEN }}
        run: >
          npx genxapi publish
          --owner ${{ github.repository_owner }}
          --repo ${{ github.event.repository.name }}
          --tag v${{ github.run_number }}
          --title "Automated client refresh"
          --body "Generated by GenX API workflow."
```

> ğŸ’¡ Tip: Use a **fine-grained personal access token** for `GENERATOR_GITHUB_TOKEN` with `Contents` and `Pull requests` write access to allow branch pushes and PR creation.

## Cache Orval & Dependencies

The template installs dependencies via the configured package manager. Cache the generated projectâ€™s `node_modules` to speed up repeated runs:

```yaml
      - name: Cache generated project deps
        uses: actions/cache@v4
        with:
          path: sdk/petstore/node_modules
          key: node-${{ runner.os }}-${{ hashFiles('sdk/petstore/package-lock.json') }}
          restore-keys: |
            node-${{ runner.os }}-
```

Adjust the path to match `project.directory`.

## Matrix Strategies

Generate clients across multiple specs or branches:

```yaml
jobs:
  generate:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        config:
          - genxapi.config.json
          - services/payments/genxapi.config.yaml
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install --no-save @genxapi/cli
      - run: npx genxapi generate --config ${{ matrix.config }}
        env:
          GITHUB_TOKEN: ${{ secrets.GENERATOR_GITHUB_TOKEN }}
```

Each matrix entry resolves paths relative to the repository root. Override output directories with `--target` if needed.

## Failing Fast on Swagger Changes

Prevent unapproved API changes from merging by running the `diff` command before generation:

```yaml
      - name: Diff OpenAPI
        run: >
          npx genxapi diff
          --base specs/petstore-main.yaml
          --head specs/petstore-pr.yaml
          --format summary
```

> ğŸ’¡ Tip: Emit the diff as Markdown (`--format markdown`) and attach it to PR comments for reviewers.

## Integrate with Other CI Providers

- **GitLab CI/CD** â€“ run `npx genxapi generate` inside a Node.js image and set `GITHUB_TOKEN`/`NPM_TOKEN` as masked variables.
- **CircleCI** â€“ add a Node orb, install the CLI, and reuse the same commands. Persist the generated project as a workspace to share across jobs.
- **Azure Pipelines** â€“ use the Node task, install via `npm`, and call the CLI in a script block. Consider secure variable groups for tokens.

Ensure the working directory contains the configuration file or pass `--config` explicitly.

## Handling Secrets Securely

- Store tokens as repository or organisation secrets (`Settings â–¸ Secrets and variables â–¸ Actions`).
- Rotate tokens regularly and prefer automation-scoped tokens.
- Use environment protection rules to require approvals before publishing from protected branches.

## Common Troubleshooting

| Symptom | Fix |
| ------- | --- |
| `Could not resolve entry module "dist/index.d.ts"` | Run `npm run build` in the monorepo to ensure the template and CLI are compiled before CI packaging. |
| Git pushes fail with `Authentication failed` | Confirm `repository.tokenEnv` matches the environment variable set in CI and token scopes include `repo` push access. |
| npm publish exits with `You cannot publish over the previously published versions` | Bump the generated SDK version before running the workflow or enable prerelease tags (e.g., `beta`). |

> ğŸ› ï¸ Tip: Add `continue-on-error: true` to optional steps (like publishing) when experimenting, then remove once the pipeline is stable.

## Next Steps

- Dive into [Templates](./templates.md) to customise project scaffolding.
- Learn about [Versioning strategies](./versioning.md) to automate releases downstream.

---

**Next:** [Templates â†’](./templates.md)
